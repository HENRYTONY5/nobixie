<%- include("template/header") %>
    <%- include("template/navbar") %>
        <%- include("template/aside") %>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


        <script>
            function confirmation_empleado() {
    Swal.fire({
        title: 'Ingrese su ID de Empleado',
        input: 'text',
        inputAttributes: {
            autocapitalize: 'off',
            placeholder: 'ID Empleado'
        },
        showCancelButton: true,
        confirmButtonText: 'Aceptar',
        cancelButtonText: 'Cancelar',
        showLoaderOnConfirm: true,
        preConfirm: (id_empleado) => {
            // Hacer la petición a la API para obtener todos los id_empleados
                return fetch('/asistencia-auth') // Solicita todos los id_empleado a la API
                    .then(response => {
                    if (!response.ok) {
                            throw new Error(response.statusText);
                        }
                        return response.json(); // Convertir la respuesta a JSON
                    })
                .then(data => {
                    const empleadoExiste = data.some(empleado => empleado.id_empleado == id_empleado);

                    if (!empleadoExiste) {
                        throw new Error('ID de empleado no encontrado');
                    }
                    
                    // Guardar id_empleado en sesión
                    return fetch('/asistencia/store-session', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id_empleado })
                    });
                })
                .catch(error => {
                    Swal.showValidationMessage(`Error: ${error.message}`);
                });
                        },
                        allowOutsideClick: () => !Swal.isLoading()
                        }).then((result) => {
                        if (result.isConfirmed) {
                        Swal.fire({
                        title: 'Acceso autorizado',
                        text: 'Usuario encontrado, redirigiendo...',
                        icon: 'success'
                        }).then(() => {
                        window.location.href = '/events'; // Redirigir a la página de guía
                    });
                }
                });
            }

        </script>
           <script>
            
function confirmation_empleado0() {
    Swal.fire({
        title: 'Ingrese su ID de Empleado',
        input: 'text',
        inputAttributes: {
            autocapitalize: 'off',
            placeholder: 'ID Empleado'
        },
        showCancelButton: true,
        confirmButtonText: 'Aceptar',
        cancelButtonText: 'Cancelar',
        preConfirm: (id_empleado) => {
            if (!id_empleado) {
                Swal.showValidationMessage('Debe ingresar un ID válido');
                return;
            }

            // Hacer una petición a la API para verificar si el ID existe
            return fetch('/asistencia-auth')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la API');
                    }
                    return response.json(); // Convertir la respuesta a JSON
                })
                .then(data => {
                    // Verificar si el id_empleado existe en la base de datos
                    const empleadoExiste = data.some(empleado => empleado.id_empleado == id_empleado);

                    if (!empleadoExiste) {
                        throw new Error('ID de empleado no encontrado');
                    }

                    // Si el empleado existe, guardar el ID en localStorage
                    localStorage.setItem('id_empleado', id_empleado);
                })
                .catch(error => {
                    Swal.showValidationMessage(`Error: ${error.message}`);
                });
        }
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: 'ID Guardado',
                text: 'Redirigiendo al cuestionario G2...',
                icon: 'success'
            }).then(() => {
                // Redirigir a la siguiente página
                window.location.href = '/guia2';
            });
        }
    });
}


           </script> 

            <script>
                function confirmation_empleado2() {
                    Swal.fire({
                        title: 'Confirme su ID de Empleado',
                        input: 'text',
                        inputAttributes: {
                            autocapitalize: 'off',
                            placeholder: 'ID Empleado'
                        },
                        showCancelButton: true,
                        confirmButtonText: 'Aceptar',
                        cancelButtonText: 'Cancelar',
                        showLoaderOnConfirm: true,
                        preConfirm: (id_empleado) => {
                            // Hacer la petición a la API para obtener todos los id_empleados
                            return fetch('/asistencia-auth') // Solicita todos los id_empleado a la API
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error(response.statusText);
                                    }
                                    return response.json(); // Convertir la respuesta a JSON
                                })
                                .then(data => {
                                    // Verificar si el id_empleado existe
                                    const empleadoExiste = data.some(empleado => empleado.id_empleado == id_empleado);
                
                                    if (!empleadoExiste) {
                                        throw new Error('ID de empleado no encontrado');
                                    }
                
                                    // Aquí, ya que el id_empleado existe, lo pasamos correctamente al cuerpo del POST
                                    return fetch('/asistencia/store-session', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ id_empleado }) // Aquí se manda correctamente el id_empleado
                                    });
                                })
                                .catch(error => {
                                    Swal.showValidationMessage(`Error: ${error.message}`);
                                });
                        },
                        allowOutsideClick: () => !Swal.isLoading()
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Swal.fire({
                                title: 'Acceso autorizado',
                                text: 'Usuario encontrado, redirigiendo...',
                                icon: 'success'
                            }).then(() => {
                                window.location.href = '/guia2'; // Redirigir a la página de guía
                            });
                        }
                    });
                }
                </script>
                
        
        <link rel="stylesheet" href="/css/style.css">
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <%- include('template/breadcrumb', {module: 'Cuestionarios' }) %>
                    <!-- Content Header (Page header) -->
                    <section class="content-header">
                        <div class="container-fluid">
                            <div class="row mb-2">
                                <div class="col-md-12">

                                    <div class="card">
                                        <div class="card-header">
                                            Menú de navegacion											
											

                                            <script>
                                                document.getElementById('instrucciones-leidas').addEventListener('click', function() {
                                                // Ocultar las instrucciones cuando se presiona el botón
                                                document.getElementById('instrucciones').style.display = 'none';
                                                });// El colapso del ícono seguirá funcionando debido a AdminLTE, no necesitas manejar el colapso aquí.
                                                // Pero para mostrar la sección nuevamente si se presiona el icono, AdminLTE lo hace de forma automática.

                                            </script>
                                        
                                       </div>
                                        <div class="card-body">
                                            <h5 class="card-title">* Está páguina te ayuda a tener una navegacion hacia los cuestionarios, así como a los resultados respectivos.   	 </h5> <hr><p></p>  										
                                            <br><br>
                                            
                                            
                                            <section>
                                                <div class="container mt-4">
                                                    <!-- Título estático -->
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h3 class="card-title">Cuestionario para Identificar los Factores de Riesgo Psicosocial en los Centros de Trabajo</h3>
                                                            <div class="card-tools">
                                                                <!-- Botón para colapsar o expandir -->
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Colapsar">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <!-- Contenido del cuestionario (colapsable) -->
                                                        <div class="card-body">
                                                            <p><strong>*</strong> El contenido de esta guía es un complemento para la mejor comprensión de la presente Norma, y no es de cumplimiento obligatorio, puede ser utilizada por aquellos centros de trabajo que tengan hasta 50 trabajadores.</p>
                                                            
                                                            <p><strong>**</strong> La identificación y análisis de los factores de riesgo psicosocial a que se refiere el numeral 8.1, inciso a), de la presente Norma, se podrá realizar aplicando el cuestionario siguiente:</p>
                                                            
                                                            <h4>11.1</h4>
                                                            <p>El cuestionario deberá aplicarse a todos los trabajadores del centro de trabajo.</p>
                                                            
                                                            <h4>II.2 Para la aplicación del cuestionario deberán cumplirse, al menos, las condiciones siguientes:</h4>
                                                            <h5>A) Antes de iniciar la aplicación del cuestionario deberá:</h5>
                                                            <ol>
                                                                <li>Verificar que las condiciones de las instalaciones y mobiliario sean idóneas.</li>
                                                                <li>Realizar la presentación del aplicador ante las personas a evaluar.</li>
                                                                <li>Explicar el objetivo de la evaluación.</li>
                                                                <li>Enfatizar en la protección de la privacidad y confidencialidad del manejo de los datos, y que el uso de la información proporcionada por el trabajador será exclusivamente para fines de mejora del ambiente de trabajo.</li>
                                                                <li>Dar instrucciones claras sobre cómo responder a las preguntas de las diferentes secciones; que se conteste completamente y que se consideren las condiciones de los últimos dos meses.</li>
                                                                <p> 6) Iniciar la aplicación en el orden siguiente: en primer lugar, el cuestionario sobre factores de riesgo psicosocial y, en segundo lugar, en su caso, realizar el llenado de la ficha de datos generales sobre el trabajador. 		</p> 									
                                                                          <br>                  
                                                                          <p> B) Durante la aplicación del cuestionario deberá: 			</p> 								
                                             <p> 1) Propiciar un ambiente de confianza. 		</p> 									
                                            <p> 2) Aclarar dudas y brindar apoyo a los trabajadores que lo requieran.		</p> 									
                                            <p> 3) Verificar que las indicaciones proporcionadas hayan quedado claras.		</p> 									
                                            <p> 4) Evitar interrumpir a los trabajadores cuando realicen sus respuestas.	</p> 										
                                            <p> 5) Evitar conducir, persuadir o dirigir respuestas.		</p> 									
                                                                                            
                                            <p> C) Después de la aplicación del cuestionario se deberá	</p> 										
                                            <p> 1) Recoger cada cuestionario y verificar que hayan sido respondidos completamente, sin tachaduras o enmendaduras.	</p> 										
                                            <p> 2) Comprobar que la cantidad de cuestionarios entregados corresponda con la cantidad de cuestionarios respondidos, y que a su vez corresponda con el tamaño mínimo de la muestra.	</p> 										
                                                    
                                                            </ol>
                                                        </div>
                                                    </div>
                                                </div>
                                            </section>

                                           <section>       <!-- Contenedor de las tarjetas -->
                                                <div class="container">
                                                 <div class="row">
                                                    <!-- Tarjeta 1 -->
                                                    <div class="col-md-3 col-sm-6 col-12">
                                                      <div class="card">
                                                        <div class="card-header">
                                                            <h3 class="card-title">Capturar Datos Generales </h3>
                                                         <div class="card-tools">
                                                              <!-- Botón para colapsar la tarjeta -->
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                 <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                            <div class="card-body">
                                                <p>: Captura Supervisores :</p>
                                                 <a href="/data" class="btn btn-info"> Empezar <i class="fa-regular fa-pen-to-square"></i></a>
                                                    <a href="/tabledata"onclick="confirmation_respuesta();" class="btn btn-danger"> Informe <i class="fa-solid fa-file"></i></a>
                                                        
                </div>
            </div>
        </div>

        <!-- Tarjeta 2 -->
        <div class="col-md-3 col-sm-6 col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Eventos Traumáticos</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <p>: Está es la Guía 1, completa :</p>
                    <a href="#" onclick="confirmation_empleado();" class="btn btn-info"> Empezar <i class="fa-regular fa-pen-to-square"></i></a>
                    <a href="/res_events"onclick="confirmation_respuesta();" class="btn btn-danger"> Informe <i class="fa-solid fa-file"></i></a>
                                                        
                </div>
                                                        <!-- Modal de Inicio de Sesión -->
                                    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                        <div class="modal-header">
                                        <h5 class="modal-title" id="loginModalLabel">Iniciar Sesión</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
            
        </div>
    </div>
</div>
            </div>
        </div>

        <!-- Tarjeta 3 -->
        <div class="col-md-3 col-sm-6 col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Guía de referencia 2</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <p>3: respuestas</p>
                    <a href="#" onclick="confirmation_empleado0();" class="btn btn-info"> Empezar <i class="fa-regular fa-pen-to-square"></i></a>
                    <a href="/res_guia2"onclick="confirmation_respuesta();" class="btn btn-danger"> Informe <i class="fa-solid fa-file"></i></a>
                                                       
                </div>
            </div>

        </div>

        <!-- Tarjeta 4 -->
        <div class="col-md-3 col-sm-6 col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Guía de referencia 3</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <p>3: respuestas</p>
                    <button class="btn btn-primary">Empezar</button>
                    <button class="btn btn-danger">Informe</button>
                </div>
            </div>
        </div>
    </div>
</div>

                                        </section> 
                                        </div>

                                        
                                        
                                    </div>
                                    
                                </div>
                            </div>
                        </div><!-- /.container-fluid -->
                    </section>

                    <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            
            <%- include("template/footer") %>